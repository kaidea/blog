<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>3D Quad Sorting Point Demo (Three.js Only, 3D)</title>
  <style>
    body { margin: 0; }
    canvas { display: block; }
    #desc { position: absolute; left:10px; top:10px; background:rgba(255,255,255,0.7); padding:8px; border-radius:6px;}
  </style>
</head>
<body>
  <div id="desc">
    <b>三维四边形排序点可视化 (纯Three.js)</b><br>
    红点=第1/第3顶点，蓝点=排序中心点<br>
    四个顶点分布在三维空间
  </div>
  <script src="https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.min.js"></script>
  <script>
    // 场景/相机/渲染器
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xf0f0f0);
    const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(3, 4, 8); // 摄像机有倾斜角度，更容易看出三维
    camera.lookAt(0,0,0);

    const renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // 三维分布的四边形顶点
    const A = new THREE.Vector3(-2, 1, 1);     // 第1个顶点
    const B = new THREE.Vector3(2, 1, -1);
    const C = new THREE.Vector3(2, -1, 2);     // 第3个顶点
    const D = new THREE.Vector3(-2, -1, -2);

    // 用两个三角形组成四边形
    const geometry = new THREE.BufferGeometry();
    const vertices = new Float32Array([
      A.x, A.y, A.z,  B.x, B.y, B.z,  D.x, D.y, D.z, // ABD
      B.x, B.y, B.z,  C.x, C.y, C.z,  D.x, D.y, D.z, // BCD
    ]);
    geometry.setAttribute('position', new THREE.BufferAttribute(vertices, 3));

    // 面材质
    const material = new THREE.MeshBasicMaterial({color:0x77bbff, side:THREE.DoubleSide, transparent:true, opacity:0.5});
    const mesh = new THREE.Mesh(geometry, material);
    scene.add(mesh);

    // 标记顶点A、C（红色球）
    function makeSphere(pos, color=0xff2222, size=0.13) {
      const g = new THREE.SphereGeometry(size, 16, 16);
      const m = new THREE.MeshBasicMaterial({color:color});
      const s = new THREE.Mesh(g, m);
      s.position.copy(pos);
      return s;
    }
    scene.add(makeSphere(A, 0xff2222)); // 第1顶点
    scene.add(makeSphere(C, 0xff2222)); // 第3顶点

    // 计算中心点(排序点)
    const center = new THREE.Vector3(
      (A.x + C.x) / 2,
      (A.y + C.y) / 2,
      (A.z + C.z) / 2
    );
    scene.add(makeSphere(center, 0x2222ff, 0.16)); // 蓝色球

    // 辅助线：A到C
    const lineMaterial = new THREE.LineDashedMaterial({color:0x333333, dashSize:0.2, gapSize:0.1});
    const points = [A, C];
    const lineGeo = new THREE.BufferGeometry().setFromPoints(points);
    const line = new THREE.Line(lineGeo, lineMaterial);
    line.computeLineDistances();
    scene.add(line);

    // 坐标轴
    const axesHelper = new THREE.AxesHelper(3.5);
    scene.add(axesHelper);

    // 动画
    function animate() {
      requestAnimationFrame(animate);
      renderer.render(scene, camera);
    }
    animate();

    window.addEventListener('resize', ()=>{
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>